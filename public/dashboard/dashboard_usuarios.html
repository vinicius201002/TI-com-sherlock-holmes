<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../styles/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
        <script src="/scripts/sessao.js"></script>

</head>

<body>
    <div class="barra_lateral">
        <div class="option">
            <i class="fa-solid fa-chart-simple"></i>
            <p><a href="dashboard_usuarios.html">Dashboard</a></p>
        </div>
        <div class="option">
            <i class="fa-solid fa-user"></i>
            <p><a href="usuarios.html">Usuários</a></p>
        </div>
        <div class="option">
            <i class="fa-solid fa-book"></i>
            <p><a href="postagens.html">Postagens</a></p>
        </div>
        <div class="option">
            <i class="fa-solid fa-right-to-bracket"></i>
            <p onclick="deslogar()">Sair</p>
        </div>
    </div>
    <div class="container">
        <div class="kpis">
            <div class="kpi">
                <p id="valor-kpi-1">
                    4
                </p>
                <p class="titulo-kpi">Usuários cadastrados</p>
            </div>
            <div class="kpi">
                <p id="valor-kpi-2">
                    1500
                </p>
                <p class="titulo-kpi">Acessos no site</p>
            </div>
        </div>
        <div class="dashboard-grid">
            <!-- Linha de Gráficos -->
            <div class="chart idade-media">
              <h3>Idade Média dos Usuários</h3>
              <!-- Gráfico de barras -->
              <canvas id="chartIdadeMedia"></canvas>
            </div>
            <div class="chart acessos-por-dia">
              <h3>Acessos por Dia</h3>
              <!-- Gráfico de barras -->
              <canvas id="chartAcessosPorDia"></canvas>
            </div>
        
            <!-- Linha de Listas -->
            <div id="top-acessos" class="chart top-acessos">
            </div>
            <div id="top-interacoes" class="chart maior-engajamento">
              <h3>Usuário com Maior Engajamento</h3>
              <p><strong>Usuário 4</strong>: 120 interações (comentários, curtidas)</p>
            </div>
            <div id="usuarios-inativos" class="chart inativos">
              <h3>Usuários Inativos</h3>
              <ol>
                <li>Usuário 5 - Último acesso: 2024-01-01</li>
                <li>Usuário 6 - Último acesso: 2024-01-10</li>
                <li>Usuário 7 - Último acesso: 2024-02-15</li>
              </ol>
            </div>
          </div>
    </div>
</body>

</html>
<script>
  listarUsuariosComMaisAcessos();
  listarTotalUsuarios()
  listarTotalAcessos();
  listarUsuariosInativos();

    
    function deslogar() {
        sessionStorage.clear();
        window.location.reload();
    }

    function listarUsuariosComMaisAcessos() {
      fetch(`/usuarios/usuariosMaisAcessos`, {
        method: "GET"
      })
      .then((resposta) => {
        if (resposta.ok) {
          resposta.json()
          .then((dados) => {
            var div_top_acessos = document.getElementById("top-acessos");
            var mensagem = "<h3>Usuários que Mais Acessam</h3><ul>";
            for (var i = 0; i < 2; i++) {
              mensagem += `<li><b>${i + 1}. ${dados[i].nome}</b>: ${dados[i].qtdAcesso} acessos</li>`;
            }
            mensagem += `</ul>`
            div_top_acessos.innerHTML = mensagem;
          })
          .catch((erro) => {
            console.log("Erro ao converter o JSON", erro)
          })
        }
      })
      .catch((erro) => {
        console.log(erro);
      })
    }

    function listarTotalUsuarios() {
      fetch(`/usuarios/totalUsuarios`, {
        method: "GET"
      })
      .then((resposta) => {
        if (resposta.ok) {
          resposta.json()
          .then((dados) => {
            var div_kpi_total_usuarios = document.getElementById("valor-kpi-1");
          div_kpi_total_usuarios.innerHTML = dados[0].qtd_usuarios;
          })
          .catch((erro) => {
            console.log("Erro ao converter o JSON", erro)
          })
        }
      })
      .catch((erro) => {
        console.log(erro);
      })
    }

    function listarTotalAcessos() {
      fetch(`/usuarios/totalAcessos`, {
        method: "GET"
      })
      .then((resposta) => {
        if (resposta.ok) {
          resposta.json()
          .then((dados) => {
            var div_kpi_total_acessos = document.getElementById("valor-kpi-2");
          div_kpi_total_acessos.innerHTML = dados[0].qtd_acessos;
          })
          .catch((erro) => {
            console.log("Erro ao converter o JSON", erro)
          })
        }
      })
      .catch((erro) => {
        console.log(erro);
      })
    }

    function listarUsuariosInativos() {
      fetch(`/usuarios/usuariosInativos`, {
        method: "GET"
      })
      .then((resposta) => {
        if (resposta.ok) {
          resposta.json()
          .then((dados) => {
            var div_top_acessos = document.getElementById("usuarios-inativos");
            var mensagem = "<h3>Usuários mais inativos</h3><ul>";
            for (var i = 0; i < 2; i++) {
              mensagem += `<li><b>${i + 1}. ${dados[i].nome}</b> - Último acesso: ${formatarData(dados[i].ultimo_acesso)}</li>`;
            }
            mensagem += `</ul>`
            div_top_acessos.innerHTML = mensagem;
          })
          .catch((erro) => {
            console.log("Erro ao converter o JSON", erro)
          })
        }
      })
      .catch((erro) => {
        console.log(erro);
      })
    }
    

   function formatarData(data) {
    var novaData = new Date(data);
    return `${novaData.getDate()}/${novaData.getUTCMonth() + 1}/${novaData.getFullYear()} às ${novaData.getHours()}:${novaData.getMinutes()}:${novaData.getSeconds()}`
  

   }
</script>